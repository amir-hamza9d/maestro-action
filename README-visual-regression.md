# Visual Regression Testing for Maestro

This system allows you to perform visual regression testing for your mobile app using Maestro. It compares screenshots taken during test execution with baseline screenshots and generates difference images highlighting any mismatches.

## Directory Structure

```
Screen-shots/
├── Expected/  (baseline screenshots you manually copy from Actual)
├── Actual/    (screenshots automatically captured during Maestro test runs)
└── Diff/      (difference images generated by the comparison script)
```

## Setup

1. Install the required dependencies:

```bash
npm install
```

2. Create the required directory structure manually:

```bash
mkdir -p Screen-shots/Expected Screen-shots/Actual Screen-shots/Diff
```

3. Make sure the `afterHook.yaml` file is properly configured in your Maestro project.

## Usage

### Capturing Baseline Screenshots

1. Run your Maestro tests to capture screenshots in the `Screen-shots/Actual` directory.
2. Review the screenshots and copy the ones you want to use as baselines to the `Screen-shots/Expected` directory.

```bash
# Example: Copy all screenshots from Actual to Expected to establish initial baselines
mkdir -p Screen-shots/Expected
cp Screen-shots/Actual/*.png Screen-shots/Expected/
```

### Running Visual Regression Tests

1. Run your Maestro tests as usual. The `afterHook.yaml` will automatically:
   - Run the comparison script after test execution
   - Note: The script assumes the Screen-shots directories already exist

2. Alternatively, you can manually run the comparison script:

```bash
npm run compare-screenshots
```

### Reviewing Results

After running the tests:

1. Check the console output for a summary of the comparison results.
2. Review any difference images in the `Screen-shots/Diff` directory:
   - Differences are highlighted in pink
   - A bold, bright yellow border (2px thick) surrounds the differences for enhanced visibility
   - The rest of the image remains fully visible at normal opacity
3. If differences are expected (e.g., after UI changes), update your baseline screenshots.

## Taking Screenshots in Maestro Tests

To capture screenshots during your Maestro tests, use the `takeScreenshot` command:

```yaml
- takeScreenshot:
    name: "home_screen"  # This will save as home_screen.png in Screen-shots/Actual
```

## Troubleshooting

- **Missing directories**: Ensure you've manually created the Screen-shots/Expected, Screen-shots/Actual, and Screen-shots/Diff directories before running tests.
- **Missing screenshots**: Ensure your Maestro tests include `takeScreenshot` commands.
- **Dimension mismatch errors**: Make sure the baseline and actual screenshots have the same dimensions.
- **False positives**: Adjust the threshold in the comparison script if needed.

## Advanced Configuration

You can modify the `scripts/compare_screenshots.js` file to customize:

- Comparison threshold (default: 5 for direct pixel comparison)
- Highlight colors (currently pink for differences, yellow for borders)
- Directory paths
- Error handling behavior
